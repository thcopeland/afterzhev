; Some items, like weapons and armor, are overlaid on character sprites, and are
; therefore animated. Weapons have 30 sprites: 16 for walking, 2 for idle, 12 for
; the three attacks (2 frames each). Wearable items have 20 sprites: 16 for
; walking and 4 for idle. For weapon attack and idle animations, the down-facing
; and right-facing sprites are mirrored and reused as the up-facing and down-facing
; sprites. This isn't the case for walking animations or for wearable items which
; should look different from different views.
;
; To save memory and cycles, each sprite has specific dimensions and offsets from
; the wielding character. This is stored in the first two bytes of the sprite
; data (offsets as signed 4 bit integers, dimensions as unsigned 4 bit integers).
; Since each sprite may be a different size, a pointer to the sprite is stored
; in a lookup table. This also allows us to reuse sprites within an animation.
;
; Animated Sprite LUT Entry (64 bytes)
;   relative pointer to walk up sprite 1 (2 bytes)
;   relative pointer to walk up sprite 2 (2 bytes)
;   relative pointer to walk up sprite 3 (2 bytes)
;   relative pointer to walk up sprite 4 (2 bytes)
;   ... 12 walk right, up, left
;   ... 4 idle (up and left are ignored for weapons)
;   ... 4 attack 1 (2 frames, down and right. These are ignored for wearable items)
;   ... 4 attack 2
;   ... 4 attack 3
;
; Non-animated items, like potions and amulets, have only a single fixed-size
; sprite, stored in the static_item_sprite_table. All animated items also have
; an entry in this table, which is used for the inventory view and for loose items.

.equ PADDING = TRANSPARENT

; Produces a relative pointer (byte-addressing) to the given sprite
.macro item_animation_entry ; ptr
    .dw (@0-animated_item_sprite_table)<<1
.endm

; Produces two bytes with the following layout
; [dx:4][dy:4] [width:4][height:4]
.macro item_sprite_header ; dx, dy, width, height
    .db (@0<<4)|@1, (@2<<4)|@3
.endm

.macro empty_animation_entry
    .dw 0x0000, 0x0000
.endm

animated_item_sprite_lut:
    item_animation_entry __wooden_stick_walk_down_0
    item_animation_entry __wooden_stick_walk_down_1
    item_animation_entry __wooden_stick_walk_down_2
    item_animation_entry __wooden_stick_walk_down_3
    item_animation_entry __wooden_stick_walk_right_0
    item_animation_entry __wooden_stick_walk_right_1
    item_animation_entry __wooden_stick_walk_right_2
    item_animation_entry __wooden_stick_walk_right_3
    item_animation_entry __wooden_stick_walk_up_0
    item_animation_entry __wooden_stick_walk_up_1
    item_animation_entry __wooden_stick_walk_up_2
    item_animation_entry __wooden_stick_walk_up_3
    item_animation_entry __wooden_stick_walk_left_0
    item_animation_entry __wooden_stick_walk_left_1
    item_animation_entry __wooden_stick_walk_left_2
    item_animation_entry __wooden_stick_walk_left_3
    item_animation_entry __wooden_stick_idle_down
    item_animation_entry __wooden_stick_idle_right
    empty_animation_entry ; idle up
    empty_animation_entry ; idle left
    ; item_animation_entry attack 1 down frame 1
    ; item_animation_entry attack 1 down frame 2
    ; item_animation_entry attack 1 right frame 1
    ; item_animation_entry attack 1 right frame 2
    ; item_animation_entry attack 2 down frame 1
    ; item_animation_entry attack 2 down frame 2
    ; item_animation_entry attack 2 right frame 1
    ; item_animation_entry attack 2 right frame 2
    ; item_animation_entry attack 3 down frame 1
    ; item_animation_entry attack 3 down frame 2
    ; item_animation_entry attack 3 right frame 1
    ; item_animation_entry attack 3 right frame 2

animated_item_sprite_table:
__wooden_stick_walk_down_0:
    item_sprite_header -5, 1, 5, 5
    .db 0x0a, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a
    .db 0x0a, 0x0a, 0xc7, 0xc7, 0xc7, 0xc7
    .db 0x0a, 0x0a, 0xc7, 0xc7, 0xc7, 0x14
    .db 0x0a, 0x0a, 0xc7, 0xc7, 0xc7, 0x0a
    .db 0xc7, PADDING
__wooden_stick_walk_down_1:
    item_sprite_header -5, 2, 8, 3
    .db 0x0a, 0x0a, 0x0a, 0x0a, 0xc7, 0xc7, 0xc7, 0xc7
    .db 0xc7, 0xc7, 0xc7, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x14, 0x0a, 0xc7
__wooden_stick_walk_down_2:
    item_sprite_header -5, 0, 5, 6
    .db 0xc7, 0xc7, 0x0a, 0xc7, 0x0a, 0xc7
    .db 0xc7, 0xc7, 0x0a, 0x0a, 0xc7, 0xc7
    .db 0x0a, 0x14, 0xc7, 0xc7, 0x0a, 0x0a
    .db 0xc7, 0xc7, 0x14, 0x0a, 0xc7, 0xc7
    .db 0xc7, 0x0a, 0xc7, 0xc7, 0xc7, 0xc7
__wooden_stick_walk_down_3:
    item_sprite_header -5, 0, 5, 5
    .db 0x0a, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a
    .db 0x0a, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a
    .db 0x0a, 0xc7, 0xc7, 0xc7, 0xc7, 0x14
    .db 0x0a, 0x0a, 0xc7, 0xc7, 0xc7, 0x0a
    .db 0xc7, PADDING
__wooden_stick_walk_right_0:
    item_sprite_header 0, 0, 8, 4
    .db 0x0a, 0x0a, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7
    .db 0xc7, 0x0a, 0x0a, 0x0a, 0x14, 0xc7, 0xc7, 0xc7
    .db 0xc7, 0xc7, 0xc7, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a
__wooden_stick_walk_right_1:
    item_sprite_header 0, 0, 8, 3
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a, 0xc7
    .db 0x0a, 0x0a, 0x0a, 0x0a, 0x14, 0x0a, 0x0a, 0x0a
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a
__wooden_stick_walk_right_2:
    item_sprite_header 0, 0, 7, 4
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a, 0xc7, 0xc7
    .db 0xc7, 0xc7, 0x0a, 0x0a, 0x0a, 0x0a, 0xc7, 0x0a
    .db 0x0a, 0x0a, 0x14, 0xc7, 0xc7, 0x0a, 0x0a, 0xc7
    .db 0xc7, 0xc7, 0xc7, 0xc7
__wooden_stick_walk_right_3:
    item_sprite_header 0, 0, 7, 3
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a, 0xc7, 0x0a
    .db 0x0a, 0x0a, 0x14, 0x0a, 0x0a, 0x0a, 0xc7, 0xc7
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0x0a, PADDING
__wooden_stick_walk_up_0:
    item_sprite_header 0, 0, 4, 5
    .db 0xc7, 0xc7, 0x0a, 0xc7
    .db 0xc7, 0x0a, 0x0a, 0x0a
    .db 0xc7, 0x0a, 0xc7, 0xc7
    .db 0x0a, 0x0a, 0xc7, 0xc7
    .db 0x0a, 0xc7, 0xc7, 0xc7
__wooden_stick_walk_up_1:
    item_sprite_header 0, 0, 3, 3
    .db 0xc7, 0xc7, 0x0a, 0x0a
    .db 0x0a, 0x0a, 0x0a, 0xc7
    .db 0xc7, PADDING
__wooden_stick_walk_up_2:
    item_sprite_header 0, 0, 5, 5
    .db 0xc7, 0xc7, 0xc7, 0x0a, 0xc7, 0xc7
    .db 0xc7, 0x0a, 0x0a, 0x0a, 0xc7, 0xc7
    .db 0x0a, 0xc7, 0xc7, 0xc7, 0x0a, 0x0a
    .db 0xc7, 0xc7, 0x0a, 0x0a, 0xc7, 0xc7
    .db 0xc7, PADDING
__wooden_stick_walk_up_3:
    item_sprite_header 0, 0, 5, 4
    .db 0xc7, 0xc7, 0xc7, 0x0a, 0xc7, 0xc7
    .db 0xc7, 0x0a, 0x0a, 0x0a, 0xc7, 0x0a
    .db 0x0a, 0xc7, 0xc7, 0x0a, 0xc7, 0xc7
    .db 0xc7, 0xc7
__wooden_stick_walk_left_0:
    item_sprite_header 0, 0, 6, 6
    .db 0xc7, 0x0a, 0xc7, 0xc7, 0xc7, 0xc7
    .db 0x0a, 0x0a, 0xc7, 0xc7, 0xc7, 0xc7
    .db 0xc7, 0x0a, 0x0a, 0xc7, 0xc7, 0xc7
    .db 0xc7, 0xc7, 0x0a, 0x0a, 0xc7, 0xc7
    .db 0xc7, 0xc7, 0xc7, 0x0a, 0x0a, 0xc7
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0x0a, 0x0a
__wooden_stick_walk_left_1:
    item_sprite_header 0, 0, 8, 2
    .db 0xc7, 0x0a, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7
    .db 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a
__wooden_stick_walk_left_2:
    item_sprite_header 0, 0, 7, 5
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a, 0x0a, 0xc7
    .db 0xc7, 0xc7, 0x0a, 0x0a, 0x0a, 0xc7, 0xc7, 0xc7
    .db 0x0a, 0x0a, 0xc7, 0xc7, 0xc7, 0x0a, 0x0a, 0x0a
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a, 0xc7, 0xc7
    .db 0xc7, 0xc7, 0xc7, PADDING
__wooden_stick_walk_left_3:
    item_sprite_header 0, 0, 7, 3
    .db 0xc7, 0x0a, 0xc7, 0xc7, 0xc7, 0xc7, 0xc7, 0x0a
    .db 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0xc7, 0xc7
    .db 0xc7, 0xc7, 0xc7, 0x0a, 0xc7, PADDING
__wooden_stick_idle_down:
    item_sprite_header 0, 0, 4, 8
    .db 0xc7, 0xc7, 0x0a, 0xc7
    .db 0xc7, 0xc7, 0x0a, 0x0a
    .db 0xc7, 0x0a, 0x0a, 0xc7
    .db 0xc7, 0x0a, 0x14, 0xc7
    .db 0xc7, 0x0a, 0xc7, 0xc7
    .db 0x0a, 0x0a, 0xc7, 0xc7
    .db 0x14, 0xc7, 0xc7, 0xc7
    .db 0x0a, 0xc7, 0xc7, 0xc7
__wooden_stick_idle_right:
    item_sprite_header 0, 0, 4, 8
    .db 0xc7, 0xc7, 0x0a, 0xc7
    .db 0xc7, 0xc7, 0x0a, 0x0a
    .db 0xc7, 0x0a, 0x0a, 0xc7
    .db 0xc7, 0x0a, 0x14, 0xc7
    .db 0xc7, 0x0a, 0xc7, 0xc7
    .db 0x0a, 0x0a, 0xc7, 0xc7
    .db 0x14, 0xc7, 0xc7, 0xc7
    .db 0x0a, 0xc7, 0xc7, 0xc7

static_item_sprite_table:
__wooden_stick:
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0x13, 0xc7	;         XX
    .db 0xc7, 0xc7, 0xc7, 0xc7, 0x13, 0x0a	;         XXWW
    .db 0xc7, 0xc7, 0xc7, 0x13, 0x5d, 0xc7	;       XX~~
    .db 0xc7, 0xc7, 0x13, 0x0a, 0xc7, 0xc7	;     XXWW
    .db 0xc7, 0x5d, 0x0a, 0xc7, 0xc7, 0xc7	;   ~~WW
    .db 0x13, 0x0a, 0xc7, 0xc7, 0xc7, 0xc7	; XXWW
__red_potion:
    .db 0xc7, 0x54, 0x13, 0x13, 0x0a, 0xc7	;   xxXXXXWW
    .db 0xc7, 0xff, 0x5f, 0x5f, 0xfe, 0xc7	;     ----..
    .db 0xc7, 0xff, 0x0d, 0x0d, 0xfe, 0xc7	;     XXXX..
    .db 0xfe, 0x0d, 0x0d, 0x0d, 0x03, 0xed	; ..XXXXXXWW,,
    .db 0xfe, 0x0d, 0x03, 0x03, 0x03, 0xed	; ..XXWWWWWW,,
    .db 0xc7, 0xfe, 0x03, 0x03, 0xed, 0xc7	;   ..WWWW,,
__green_potion:
    .db 0xc7, 0xc7, 0xc7, 0xff, 0x54, 0x13	;         xxXX
    .db 0xc7, 0xc7, 0xff, 0x74, 0x28, 0x0a	;       --XXWW
    .db 0xc7, 0xfe, 0x32, 0x28, 0x18, 0xed	;   ..xxXXWW,,
    .db 0xfe, 0x32, 0x28, 0x18, 0xed, 0xc7	; ..xxXXWW,,
    .db 0xfe, 0x18, 0x18, 0xed, 0xc7, 0xc7	; ..WWWW,,
    .db 0xfe, 0xed, 0xed, 0xc7, 0xc7, 0xc7	; ..,,,,
__useless_mint_leaves:
    .db 0xc7, 0xc7, 0x28, 0x28, 0x18, 0xc7	;     XXXXWW
    .db 0xc7, 0xc7, 0x11, 0x18, 0x18, 0x18	;     WWWWWWWW
    .db 0xc7, 0xc7, 0xc7, 0x11, 0x11, 0x18	;       WWWWWW
    .db 0xc7, 0x28, 0x28, 0x18, 0x18, 0x11	;   XXXXWWWWWW
    .db 0x28, 0x28, 0x18, 0x18, 0x18, 0x11	; XXXXWWWWWWWW
    .db 0xc7, 0x11, 0x11, 0x11, 0x11, 0xc7	;   WWWWWWWW
